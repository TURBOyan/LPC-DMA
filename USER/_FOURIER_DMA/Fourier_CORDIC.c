#include "Fourier_DMA.h"

//使用CORDIC算法实现快速三角函数

static const double g_atan_table[64] = {
	7.853981633974483E-1,  4.636476090008061E-1,  2.449786631268642E-1,  1.243549945467614E-1,
	6.241880999595735E-2,  3.123983343026828E-2,  1.562372862047683E-2,  7.812341060101111E-3,
	3.906230131966972E-3,  1.953122516478819E-3,  9.765621895593194E-4,  4.882812111948983E-4,
	2.441406201493618E-4,  1.220703118936702E-4,  6.103515617420878E-5,  3.05175781155261E-5,
	1.525878906131576E-5,  7.62939453110197E-6,   3.814697265606496E-6,  1.907348632810187E-6,
	9.536743164059609E-7,  4.768371582030889E-7,  2.38418579101558E-7,   1.192092895507807E-7,
	5.960464477539055E-8,  2.98023223876953E-8,   1.490116119384766E-8,  7.450580596923828E-9,
	3.725290298461914E-9,  1.862645149230957E-9,  9.313225746154785E-10, 4.656612873077393E-10,
	2.328306436538696E-10, 1.164153218269348E-10, 5.820766091346741E-11, 2.91038304567337E-11,
	1.455191522836685E-11, 7.275957614183426E-12, 3.637978807091713E-12, 1.818989403545856E-12,
	9.094947017729282E-13, 4.547473508864641E-13, 2.273736754432321E-13, 1.13686837721616E-13,
	5.684341886080801E-14, 2.842170943040401E-14, 1.4210854715202E-14,   7.105427357601002E-15,
	3.552713678800501E-15, 1.77635683940025E-15,  8.881784197001252E-16, 4.440892098500626E-16,
	2.220446049250313E-16, 1.110223024625157E-16, 5.551115123125783E-17, 2.775557561562891E-17,
	1.387778780781446E-17, 6.938893903907228E-18, 3.469446951953614E-18, 1.734723475976807E-18,
	8.673617379884035E-19, 4.336808689942018E-19, 2.168404344971009E-19, 1.084202172485504E-19
};

static const double g_product_cos_table[64] = {
	7.071067811865475E-1, 6.324555320336759E-1, 6.135719910778963E-1, 6.088339125177524E-1,
	6.076482562561681E-1, 6.073517701412958E-1, 6.072776440935258E-1, 6.072591122988925E-1,
	6.07254479332562E-1,  6.072533210898748E-1, 6.072530315291339E-1, 6.072529591389442E-1,
	6.072529410413965E-1, 6.072529365170094E-1, 6.072529353859126E-1, 6.072529351031383E-1,
	6.072529350324446E-1, 6.072529350147711E-1, 6.072529350103526E-1, 6.072529350092478E-1,
	6.072529350089715E-1, 6.072529350089023E-1, 6.072529350088848E-1, 6.072529350088803E-1,
	6.072529350088791E-1, 6.072529350088786E-1, 6.072529350088783E-1, 6.072529350088781E-1,
	6.072529350088778E-1, 6.072529350088776E-1, 6.072529350088773E-1, 6.072529350088771E-1,
	6.072529350088768E-1, 6.072529350088765E-1, 6.072529350088762E-1, 6.072529350088759E-1,
	6.072529350088756E-1, 6.072529350088753E-1, 6.07252935008875E-1,  6.072529350088746E-1,
	6.072529350088743E-1, 6.07252935008874E-1,  6.072529350088736E-1, 6.072529350088733E-1,
	6.072529350088729E-1, 6.072529350088725E-1, 6.072529350088721E-1, 6.072529350088717E-1,
	6.072529350088713E-1, 6.072529350088709E-1, 6.072529350088705E-1, 6.0725293500887E-1,
	6.072529350088696E-1, 6.072529350088692E-1, 6.072529350088687E-1, 6.072529350088683E-1,
	6.072529350088678E-1, 6.072529350088673E-1, 6.072529350088668E-1, 6.072529350088663E-1,
	6.072529350088658E-1, 6.072529350088653E-1, 6.072529350088648E-1, 6.072529350088642E-1
};


double my_cos(const double t)
{
	const int	n	= 50;
	double		x	= g_product_cos_table[n - 1];
	double		xt;
	double		y	= 0.0;
	double		z	= 0.0;
	double		k	= 1.0;
	int		i;

	if ( t < 0 || t > 3.1415926 / 2 )
	{
		return(0.0);
	}

	for ( i = 0; i < 25; i++ )
	{
		xt = x;
		if ( t > z )
		{
			x	= x - y * k;
			y	= y + xt * k;
			z	= z + g_atan_table[i];
		}else  {
			x	= x + y * k;
			y	= y - xt * k;
			z	= z - g_atan_table[i];
		}
		k *= 0.5;
	}
	for (; i < n; i++ )
	{
		xt = x;
		if ( t > z )
		{
			x	= x - y * k;
			y	= y + xt * k;
			z	= z + k;
		}else  {
			x	= x + y * k;
			y	= y - xt * k;
			z	= z - k;
		}
		k *= 0.5;
	}

	return(x);
}

double my_sin( const double t )
{
	const int	n	= 52;
	double		x	= g_product_cos_table[n - 1];
	double		xt;
	double		y	= 0.0;
	double		z	= 0.0;
	double		k	= 1.0;
	int		i;

	if ( t < 0 || t > 3.1415926 / 2 )
	{
		return(0.0);
	}

	for ( i = 0; i < n; i++ )
	{
		xt = x;
		if ( t > z )
		{
			x	= x - y * k;
			y	= y + xt * k;
			z	= z + g_atan_table[i];
		}else  {
			x	= x + y * k;
			y	= y - xt * k;
			z	= z - g_atan_table[i];
		}
		k *= 0.5;
	}
	return(y);
}

double my_sqrt( double y, double x )
{
	const int	n = 52;
	double		xt;
	double		z	= 0.0;
	double		k	= 1.0;
	int		i;
	if ( x < 0.0 || y < 0.0 )
	{
		return(0.0);
	}

	for ( i = 0; i < n; i++ )
	{
		xt = x;
		if ( y > 0.0 )
		{
			x	= x + y * k;
			y	= y - xt * k;
			z	= z + g_atan_table[i];
		}else  {
			x	= x - y * k;
			y	= y + xt * k;
			z	= z - g_atan_table[i];
		}
		k *= 0.5;
	}

	return(x * g_product_cos_table[n - 1]);
}